<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="rviz" default="true"/>
    <arg name="from_bag" default="false"/>
    <arg name="odom" default="gt"/>
    <arg name="device" default="cpu"/>
    <arg name="pub_gt_mesh" default="false"/>
    <arg name="depth_completion" default="false"/>
    <arg name="gt_depth" default="false"/>

    <group if="$(eval from_bag)">
        <param name="use_sim_time" value="true"/>

        <include file="$(dirname)/play_bag.launch">
            <arg name="bag" value="$(find supervised_depth_correction)/data/explorer_x1_rgbd_traj_2021-09-22-14-34-21.bag"/>
            <arg name="start" value="0.0"/>
            <arg name="rate" value="0.3"/>
        </include>

        <!-- GradSLAM step inference -->
        <node name="supervised_depth_correction" pkg="supervised_depth_correction" type="gradslam_bag" output="screen">
            <param name="odometry" value="$(arg odom)"/>
            <param name="device" value="$(arg device)"/>
        </node>

        <!-- GT mesh of the world publisher -->
        <node if="$(arg pub_gt_mesh)"
              name="gt_world_publisher" pkg="supervised_depth_correction" type="gt_world_pub" output="screen"/>
    </group>

    <group if="$(eval not from_bag)">
        <!-- GradSLAM step inference -->
        <node name="supervised_depth_correction" pkg="supervised_depth_correction" type="gradslam_data" output="screen">
            <param name="odometry" value="$(arg odom)"/>
            <param name="device" value="$(arg device)"/>
            <param name="depth_completion" value="$(arg depth_completion)"/>
            <param name="gt_depth" value="$(arg gt_depth)"/>
        </node>
    </group>

    <!-- RVIZ -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz"
          args="-d $(find supervised_depth_correction)/config/rviz/config.rviz"/>
</launch>
